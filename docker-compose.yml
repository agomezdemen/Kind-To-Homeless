services:
  nominatim:
    image: mediagis/nominatim:4.4
    container_name: nominatim
    ports:
      - "7543:8080"
    environment:
      PBF_URL: "https://download.geofabrik.de/north-america/us-latest.osm.pbf"
      REPLICATION_URL: "https://download.geofabrik.de/north-america/us-updates/"
      IMPORT_WIKIPEDIA: "false"
      NOMINATIM_PASSWORD: "nominatim_password"
    volumes:
      - nominatim-data:/var/lib/postgresql/14/main
      - nominatim-flatnode:/nominatim/flatnode
    shm_size: 1gb

  api:
    build: .
    container_name: kind-to-homeless-api
    ports:
      - "7544:8000"
    volumes:
      - ./api:/app/api
    command: uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
    depends_on:
      - nominatim

volumes:
  nominatim-data:
  nominatim-flatnode:

